@model OrderModel
<div class="panel-group">
    @if (Model.IsShippable)
                {
                   
                    if (Model.ShippingAddress != null)
                    {
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="form-group">
                        <div class="col-md-3">
                            @Html.NopLabelFor(model => model.ShippingAddress)
                        </div>
                        <div class="col-md-9">
                            <img alt="google maps" src="@Url.Content("~/Administration/Content/images/google-maps.gif")" />
                            <a href="@Html.Raw(Model.ShippingAddressGoogleMapsUrl)" style="margin-bottom: 10px;" target="_blank">@T("Admin.Orders.Fields.ShippingAddress.ViewOnGoogleMaps")</a>

                            <table class="table table-hover table-bordered" style="max-width: 400px;">
                                @if (Model.ShippingAddress.FirstNameEnabled || Model.ShippingAddress.LastNameEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.FullName")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.FirstName @Model.ShippingAddress.LastName
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.EmailEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Email")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.Email
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.PhoneEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Phone")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.PhoneNumber
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.FaxEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Fax")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.FaxNumber
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.CompanyEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Company")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.Company
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.StreetAddressEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Address1")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.Address1
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.StreetAddress2Enabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Address2")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.Address2
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.CityEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.City")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.City
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.StateProvinceEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.StateProvince")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.StateProvinceName
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.ZipPostalCodeEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.ZipPostalCode")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.ZipPostalCode
                                        </td>
                                    </tr>
                                }
                                @if (Model.ShippingAddress.CountryEnabled)
            {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Country")
                                        </td>
                                        <td>
                                            @Model.ShippingAddress.CountryName
                                        </td>
                                    </tr>
                                }
                                @if (!String.IsNullOrEmpty(Model.RCNumber))
                                {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Country")
                                        </td>
                                        <td>
                                            @Model.RCNumber
                                        </td>
                                    </tr>
                                }
                                                    @if (!String.IsNullOrEmpty(Model.MailStopAddress))
                                                    {
                                                        <tr>
                                                            <td>
                                                                @T("Admin.Orders.Address.Country")
                                                            </td>
                                                            <td>
                                                                @Model.MailStopAddress
                                                            </td>
                                                        </tr>
                                                    }

                                @if (!String.IsNullOrEmpty(Model.ShippingAddress.FormattedCustomAddressAttributes))
                                {
                                    <tr class="custom-attributes-view">
                                        <td colspan="2">
                                            @Html.Raw(Model.ShippingAddress.FormattedCustomAddressAttributes)
                                        </td>
                                    </tr>
                                }
                            </table>
                        </div>
                    </div>
                    @if (!Model.IsReadOnly)
                    {
                        if (Model.IsLoggedAs=="ADMIN"|| Model.IsLoggedAs == "STORE.ADMIN")    // NU-30
                        {
                            <div class="form-group">
                                <div class="col-md-9 col-md-offset-3">
                                    <a href="@Url.Action("AddressEdit", new { addressId = Model.ShippingAddress.Id, orderId = Model.Id })" class="btn btn-primary">@T("Admin.Common.Edit")</a>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        }

        if (Model.PickupAddress != null)
        {
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="form-group">
                        <div class="col-md-3">
                            @Html.NopLabelFor(model => model.PickupAddress)
                        </div>
                        <div class="col-md-9">
                            <img alt="google maps" src="@Url.Content("~/Administration/Content/images/google-maps.gif")" />
                            <a href="@Html.Raw(Model.PickupAddressGoogleMapsUrl)" style="margin-bottom: 10px;" target="_blank">@T("Admin.Orders.Fields.PickupAddress.ViewOnGoogleMaps")</a>

                            <table class="table table-hover table-bordered" style="max-width: 400px;">
                                @if (!string.IsNullOrEmpty(Model.PickupAddress.Address1))
                                {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Address1")
                                        </td>
                                        <td>
                                            @Model.PickupAddress.Address1
                                        </td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Model.PickupAddress.City))
                                {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.City")
                                        </td>
                                        <td>
                                            @Model.PickupAddress.City
                                        </td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Model.PickupAddress.CountryName))
                                {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.Country")
                                        </td>
                                        <td>
                                            @Model.PickupAddress.CountryName
                                        </td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Model.PickupAddress.ZipPostalCode))
                                {
                                    <tr>
                                        <td>
                                            @T("Admin.Orders.Address.ZipPostalCode")
                                        </td>
                                        <td>
                                            @Model.PickupAddress.ZipPostalCode
                                        </td>
                                    </tr>
                                }

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        }

        <div class="panel panel-default">
            <div class="panel-body">
                @if (!Model.IsLoggedInAsVendor)
                {
                    <div class="form-group">
                        <div class="col-md-3">
                            @Html.NopLabelFor(model => model.ShippingStatus)
                        </div>
                        <div class="col-md-9">
                            @Html.NopDisplayFor(model => model.ShippingStatus)
                        </div>
                    </div>
                }
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                @if (!Model.IsLoggedInAsVendor)
                {
                    if (!String.IsNullOrEmpty(Model.RCNumber))
                    {
                        <div class="form-group">
                            <div class="col-md-3">
                                @Html.NopLabelFor(model => model.RCNumber)
                            </div>
                            <div class="col-md-3">
                                @Html.NopEditorFor(model => model.RCNumber)
                            </div>
                            @if (!Model.IsReadOnly)
                            {
                                if (Model.IsLoggedAs == "ADMIN")
                                {
                                    <div class="col-md-3">
                                        <a href="" class="btn btn-primary" name="saveRCNumber" id="saveRCNumber" onclick="updateRCHref();">@T("Admin.Common.Update")</a>
                                    </div>
                                }
                            }
                        </div>
                    }
                    if (!String.IsNullOrEmpty(Model.MailStopAddress))
                    {
                        <div class="form-group">
                            <div class="col-md-3">
                                @Html.NopLabelFor(model => model.MailStopAddress)
                            </div>
                            <div class="col-md-3">
                                @Html.NopEditorFor(model => model.MailStopAddress)
                            </div>
                            @if (!Model.IsReadOnly)
                            {
                                if (Model.IsLoggedAs == "ADMIN")
                                {
                                    <div class="col-md-3">
                                        <a class="btn btn-primary" href="" name="saveMailStopAddress" id="saveMailStopAddress" onclick="updateMSHref();">@T("Admin.Common.Update")</a>
                                    </div>
                                }
                            }
                        </div>
                    }
                }
            </div>
            
        </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    @T("Admin.Orders.Shipments")
                </div>
                <div class="panel-body">
                    <div id="shipments-grid"></div>
                    <script>
                        function updateMSHref() {
                            var address = $("input[name='MailStopAddress']").val();
                           $.ajax(
                                {
                                    type: 'POST',
                                    dataType: 'JSON',
                                    url: "@Html.Raw(Url.Action("UpdateMailStopAddress", "Order"))",
                                   data: { msAddress: address , orderId : @Model.Id},
                                    success:
                                        function (response) {
                                        },
                                    error:
                                        function (response) {
                                        }
                                });
                        }

                        function updateRCHref() {
                          var rcno = $("input[name='RCNumber']").val();
                           $.ajax(
                                {
                                    type: 'POST',
                                    dataType: 'JSON',
                                    url: "@Html.Raw(Url.Action("UpdateRCNumber", "Order"))",
                                    data: { rcNumber: rcno, orderId : @Model.Id },
                                    success:
                                        function (response) {
                                        },
                                    error:
                                        function (response) {
                                        }
                                });
                        }

                        $(document).ready(function () {
                            $("#shipments-grid").kendoGrid({
                                dataSource: {
                                    type: "json",
                                    transport: {
                                        read: {
                                            url: "@Html.Raw(Url.Action("ShipmentsByOrder", "Order", new {orderId = Model.Id}))",
                                            type: "POST",
                                            dataType: "json",
                                            data: addAntiForgeryToken
                                        }
                                    },
                                    schema: {

                                        data: "Data",

                                        parse: function (data) {
                                            // Example adding a new field to the received data
                                            // that computes price as price times quantity.
                                            $.each(data, function (idx, elem) {

                                            });
                                            return data;
                                        },
                                        total: "Total",
                                        errors: "Errors"
                                    },
                                    error: function (e) {
                                        display_kendoui_grid_error(e);
                                        // Cancel the changes
                                        this.cancelChanges();
                                    },
                                    serverPaging: true,
                                    serverFiltering: true,
                                    serverSorting: true
                                },
                                pageable: {
                                    refresh: true,
                                    numeric: false,
                                    previousNext: false,
                                    info: false
                                },
                                //details grid
                                detailInit: detailInit,
                                scrollable: false,
                                columns: [
                                    {
                                        field: "Id",
                                        title: "@T("Admin.Orders.Shipments.ID")",
                                        width: 50
                                    }, {
                                        field: "OrderId",
                                        title: "@T("Admin.Orders.Shipments.OrderID")",
                                        width: 100
                                    }, {
                                        field: "TrackingNumber",
                                        title: "@T("Admin.Orders.Shipments.TrackingNumber")",
                                        width: 100
                                    }, {
                                        field: "TotalWeight",
                                        title: "@T("Admin.Orders.Shipments.TotalWeight")",
                                        width: 100
                                    }, {
                                        field: "ShippedDate",
                                        title: "@T("Admin.Orders.Shipments.ShippedDate")",
                                        width: 200,
                                        type: "date",
                                        format: "{0:G}"
                                    }, {
                                        field: "DeliveryDate",
                                        title: "@T("Admin.Orders.Shipments.DeliveryDate")",
                                        width: 200,
                                        type: "date",
                                        format: "{0:G}"
                                    },

                                    {
                                        field: "VendorId",
                                        title: "@T("Admin.Common.View")",
                                        width: 50,
                                        template: '#if(VendorId <=0) {# <a href="@Url.Content("~/Admin/Order/ShipmentDetails/")#=Id#">View</a> # } else {}#'
                                    }
                                ]
                            });
                        });

                        //details grid
                        function detailInit(e) {
                            $("<div/>").appendTo(e.detailCell).kendoGrid({
                                dataSource: {
                                    type: "json",
                                    transport: {
                                        read: {
                                            url: "@Html.Raw(Url.Action("ShipmentsItemsByShipmentId", "Order"))?shipmentId=" + e.data.Id,
                                            type: "POST",
                                            dataType: "json",
                                            data: addAntiForgeryToken
                                        }
                                    },
                                    schema: {
                                        data: "Data",
                                        total: "Total",
                                        errors: "Errors"
                                    },
                                    error: function (e) {
                                        display_kendoui_grid_error(e);
                                        // Cancel the changes
                                        this.cancelChanges();
                                    },
                                    serverPaging: true,
                                    serverFiltering: true,
                                    serverSorting: true
                                },
                                scrollable: false,
                                sortable: true,
                                pageable: {
                                    refresh: true,
                                    numeric: false,
                                    previousNext: false,
                                    info: false
                                },
                                columns: [
                                    {
                                        field: "ProductName",
                                        title: "@T("Admin.Orders.Shipments.Products.ProductName")",
                                        width: 400
                                    }, {
                                        field: "ShippedFromWarehouse",
                                        title: "@T("Admin.Orders.Shipments.Products.Warehouse")",
                                        width: 150
                                    }, {
                                        field: "QuantityInThisShipment",
                                        title: "@T("Admin.Orders.Shipments.Products.QtyShipped")",
                                        width: 150
                                    }, {
                                        field: "ItemWeight",
                                        title: "@T("Admin.Orders.Shipments.Products.ItemWeight")",
                                        width: 150
                                    }, {
                                        field: "ItemDimensions",
                                        title: "@T("Admin.Orders.Shipments.Products.ItemDimensions")",
                                        width: 150
                                    }
                                ]
                            });
                        }
                    </script>
                </div>

                @if (Model.CanAddNewShipments)
                {
                    <div class="panel-footer">
                        <button type="submit" id="btnAddNewShipment" name="btnAddNewShipment" onclick="javascript:setLocation('@(Url.Action("AddShipment", "Order", new {orderId = Model.Id}))'); return false;" class="btn btn-primary">
                            @T("Admin.Orders.Shipments.AddNew")
                        </button>
                    </div>
                }
            </div>
    }
    else
    {
        <div class="panel panel-default">
            <div class="panel-body">
                @T("Admin.Orders.ShippingInfo.NotRequired")
            </div>
        </div>
    }
</div>
<script>
    var grid = $("#grid").kendoGrid();
</script>